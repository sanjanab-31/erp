services:
  # 1. Backend API Service
  - type: web
    name: erp-backend
    env: node
    plan: free
    rootDir: backend
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: MONGO_URL
        sync: false # Set this in Render Dashboard
      - key: JWT_SECRET
        sync: false # Set this in Render Dashboard
      - key: PORT
        value: 5000
      - key: FRONTEND_URL
        value: https://erp-frontend-yourname.onrender.com # Update this after frontend is created

  # 2. Payment Server (Stripe)
  - type: web
    name: erp-payment-server
    env: node
    plan: free
    rootDir: payment-server
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: STRIPE_SECRET_KEY
        sync: false # Set this in Render Dashboard
      - key: PORT
        value: 4242

  # 3. Frontend Static Site
  - type: static
    name: erp-frontend
    rootDir: frontend
    buildCommand: rm -rf node_modules package-lock.json && npm install --force && npm run build
    publishDir: dist
    routes:
      # This rule prevents 404 errors when refreshing the page on a React Single Page App (SPA)
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_API_URL
        value: https://erp-backend-qbu2.onrender.com/api
      - key: VITE_PAYMENT_SERVER_URL
        value: https://erp-payment-server.onrender.com
